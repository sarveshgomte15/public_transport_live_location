<!DOCTYPE html>
<html>
<head>
  <title>Passenger App</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    #map { height: 500px; }
  </style>
</head>
<body>
  <h2>Passenger App - Live Bus Tracking</h2>
  <div id="map"></div>

  <script>
    const SERVER_URL = "https://your-render-url.onrender.com"; // replace with Render URL
    const map = L.map("map").setView([20.5937, 78.9629], 5);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    const busMarkers = {};

    async function fetchBuses() {
      try {
        const res = await axios.get(`${SERVER_URL}/get_buses`);
        const buses = res.data;

        buses.forEach(bus => {
          if (busMarkers[bus.driver_id]) {
            busMarkers[bus.driver_id].setLatLng([bus.lat, bus.lng]);
          } else {
            const marker = L.marker([bus.lat, bus.lng]).addTo(map);
            marker.bindPopup(
              `<b>Bus No:</b> ${bus.bus_no}<br>
               <b>Driver:</b> ${bus.name}<br>
               <b>From:</b> ${bus.from} â†’ <b>To:</b> ${bus.to}<br>
               <b>Full:</b> ${bus.full ? "Yes" : "No"}`
            );
            busMarkers[bus.driver_id] = marker;
          }
        });
      } catch (err) {
        console.error("Error fetching buses:", err);
      }
    }

    setInterval(fetchBuses, 5000);
  </script>
</body>
</html>
